<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Chat App</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <script>
        function deselectChat() {
            window.location.href = "{{ url_for('index') }}";
        }

        function toggleSidebar() {
            var sidebar = document.getElementById('sidebar');
            var toggleIcon = document.getElementById('toggle-icon');
            sidebar.classList.toggle('active');

            // Verifica se a sidebar está ativa (recolhida)
            if (sidebar.classList.contains('active')) {
                // Sidebar está recolhida, mostra o ícone de "Expandir menu"
                toggleIcon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#434343"><path d="M120-240v-80h240v80H120Zm0-200v-80h480v80H120Zm0-200v-80h720v80H120Z"/></svg>';
            } else {
                // Sidebar está expandida, mostra o ícone de "Recolher menu"
                toggleIcon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFF"><path d="M120-240v-80h240v80H120Zm0-200v-80h480v80H120Zm0-200v-80h720v80H120Z"/></svg>';
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
        var textarea = document.querySelector('.input-with-button textarea');

        // Função para auto-redimensionar o textarea
        function autoResize() {
            textarea.style.height = 'auto';
            var newHeight = textarea.scrollHeight;
            if (newHeight > 300) {
                newHeight = 300;
                textarea.style.overflowY = 'scroll';
            } else {
                textarea.style.overflowY = 'hidden';
            }
            textarea.style.height = newHeight + 'px';
        }

        // Adicionar evento de entrada
        textarea.addEventListener('input', autoResize);

        // Inicializar a altura
        autoResize();
    });

    </script>
</head>
<body>
    <div class="wrapper">
        <!-- Sidebar -->
        <nav id="sidebar" class="active">
            <div class="sidebar-header">

                <button onclick="deselectChat()" class="deselect-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF"><path d="M160-400v-80h280v80H160Zm0-160v-80h440v80H160Zm0-160v-80h440v80H160Zm360 560v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q8 9 12.5 20t4.5 22q0 11-4 22.5T863-380L643-160H520Zm300-263-37-37 37 37ZM580-220h38l121-122-18-19-19-18-122 121v38Zm141-141-19-18 37 37-18-19Z"/></svg>    
                </button>
        </div>

            <ul class="chat-list">
                {% for cid, conv in conversations.items() %}
                    <li {% if cid == chat_id %}class="active"{% endif %}>
                        <a href="{{ url_for('index', chat_id=cid) }}">{{ conv['name'] }}</a>
                    </li>
                {% endfor %}
            </ul>
        </nav>

            <!-- Botão para alternar a sidebar -->
            <div class="toggle-btn">
                <button onclick="toggleSidebar()" id="toggle-button">
                    <!-- Ícone SVG inicial (Recolher menu) -->
                    <span id="toggle-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#434343">
                            <path d="M120-240v-80h240v80H120Zm0-200v-80h480v80H120Zm0-200v-80h720v80H120Z"/></svg>
                        </svg>
                    </span>
                </button>
            </div>
            

        <!-- Conteúdo Principal -->
        <div id="content">

            {% if chat %}
                <!-- Cabeçalho do Chat -->
                <div class="chat-header">
                    <label>{{ chat.name }}</label>
                </div>

                <!-- Histórico de Mensagens -->
                <div class="message-history">
                    {% for message in chat.messages %}
                        <div class="message {% if message.role == 'user' %}user-message{% else %}agent-message{% endif %}">
                            {% if message.role == 'agent' %}
                                <div class="agent-icon">
                                    <!-- Seu ícone SVG -->
                                    <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" fill="#434343">
                                    <path d="m136-240-56-56 212-212q35-35 85-35t85 35l46 46q12 12 28.5 12t28.5-12l178-178H640v-80h240v240h-80v-103L621-405q-35 35-85 35t-85-35l-47-47q-11-11-28-11t-28 11L136-240Z"/>
                                    </svg>
                                </div>
                            {% endif %}
                            <div class="message-text">{{ message.text }}</div>
                        </div>
                    {% endfor %}
                </div>

                <!-- Formulário para Enviar Mensagem -->
                <form action="{{ url_for('send_message') }}" method="POST" class="input-with-button" style="width: 50%;">
                    <input type="hidden" name="chat_id" value="{{ chat_id }}">
                    <textarea type="text" name="message" placeholder="Digite sua mensagem" required></textarea>
                    <button type="submit">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF">
                            <path d="M120-160v-640l760 320-760 320Zm80-120 474-200-474-200v140l240 60-240 60v140Zm0 0v-400 400Z"/>
                        </svg>
                    </button>
                </form>
                <label style="color: #555; font-size: 12px;">Direitos reservados • 2024</label>
            {% else %}
                <!-- Se nenhum chat estiver selecionado -->

                <div class="no-chat">
                    <form action="{{ url_for('create_chat') }}" method="POST" class="start-chat-form">
                        <div class="input-with-button">
                            <h2>Como posso te ajudar?</h2>
                            <textarea name="message" placeholder=".." required></textarea>
                            <button type="submit" aria-label="Enviar mensagem">
                                <!-- Seu ícone SVG -->
                                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFFFF">
                                    <path d="M120-160v-640l760 320-760 320Zm80-120 474-200-474-200v140l240 60-240 60v140Zm0 0v-400 400Z"/>
                                </svg>
                            </button>
                        </div>

                        <div class="attach-file"></div>
                            <label for="file-input" class="attach-label">
                                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#434343"><path d="M720-330q0 104-73 177T470-80q-104 0-177-73t-73-177v-370q0-75 52.5-127.5T400-880q75 0 127.5 52.5T580-700v350q0 46-32 78t-78 32q-46 0-78-32t-32-78v-370h80v370q0 13 8.5 21.5T470-320q13 0 21.5-8.5T500-350v-350q-1-42-29.5-71T400-800q-42 0-71 29t-29 71v370q-1 71 49 120.5T470-160q70 0 119-49.5T640-330v-390h80v390Z"/></svg>
                            </label>
                            <input type="file" id="file-input" name="file" style="display: none;">
                        </div>
                        
                    </form>
                </div>
                
            {% endif %}
        </div>
    </div>
</body>
</html>
